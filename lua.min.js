(()=>{if(document.getElementById("luascript-hide-style"))return;const t=document.createElement("style");t.id="luascript-hide-style",t.textContent='\n    lua-script,\n    script[type="lua"] {\n      display: none !important;\n    }\n  ',(document.head||document.documentElement).appendChild(t);try{document.querySelectorAll("lua-script, script[type='lua']").forEach(t=>{t.hidden=!0})}catch{}})(),(()=>{try{document.querySelectorAll("lua-script, script[type='lua']").forEach(t=>{t.hidden=!0})}catch{}async function t(t){const e=await fetch(t);if(!e.ok)throw new Error(`${t} (${e.status})`);return e.text()}function e(t){const e=document.createElement("pre");return t.insertAdjacentElement("afterend",e),t=>{e.textContent+=t+"\n"}}async function n(){var n;await(n="https://unpkg.com/fengari-web/dist/fengari-web.js",new Promise((t,e)=>{if([...document.scripts].some(t=>t.src===n))return t();const r=document.createElement("script");r.src=n,r.onload=t,r.onerror=()=>e(new Error("Failed to load "+n)),document.head.appendChild(r)}));const{lua:r,lauxlib:u,lualib:l,to_luastring:a,to_jsstring:o}=window.fengari,s=u.luaL_newstate();l.luaL_openlibs(s);let i=()=>{},c=!1;const d="true"===document.currentScript?.getAttribute("debug");function _(t){c&&i("[LuaDebug] "+t)}r.lua_getglobal(s,a("debug")),r.lua_getfield(s,-1,a("traceback")),r.lua_remove(s,-2);const g=u.luaL_ref(s,r.LUA_REGISTRYINDEX);function p(t,e){const n=r.lua_gettop(s)-t;r.lua_rawgeti(s,r.LUA_REGISTRYINDEX,g),r.lua_insert(s,n);const u=r.lua_pcall(s,t,e,n);return r.lua_remove(s,n),u}function f(t){if(!c)return void r.lua_pop(s,1);const e=function(t){u.luaL_tolstring(s,t);const e=r.lua_tostring(s,-1),n=e?o(e):"";return r.lua_pop(s,1),n}(-1);r.lua_pop(s,1),i(`[LuaError] ${t}: ${e}`)}function h(t){null!=t?"number"!=typeof t?"boolean"!=typeof t?r.lua_pushstring(s,a(String(t))):r.lua_pushboolean(s,t?1:0):r.lua_pushnumber(s,t):r.lua_pushnil(s)}function m(t,...e){if(r.lua_getglobal(s,a(t)),!r.lua_isfunction(s,-1))return r.lua_pop(s,1),void _(`callback not found: ${t}`);for(const t of e)h(t);p(e.length,0)!==r.LUA_OK&&f("callback")}function b(t,...e){if(r.lua_rawgeti(s,r.LUA_REGISTRYINDEX,t),!r.lua_isfunction(s,-1))return r.lua_pop(s,1),void _(`callback ref not a function: ${t}`);for(const t of e)h(t);p(e.length,0)!==r.LUA_OK&&f("callback")}function L(t,e){r.lua_getglobal(s,a("package")),r.lua_getfield(s,-1,a("preload")),r.lua_pushstring(s,a(e)),r.lua_pushcclosure(s,function(t){const e=r.lua_tostring(t,r.lua_upvalueindex(1)),n=e?o(e):"";return u.luaL_loadstring(t,a(n))!==r.LUA_OK||r.lua_pcall(t,0,r.LUA_MULTRET,0)!==r.LUA_OK?r.lua_error(t):0===r.lua_gettop(t)?(r.lua_pushboolean(t,1),1):1},1),r.lua_setfield(s,-2,a(t)),r.lua_pop(s,2)}function v(t,e){try{return new URL(t,e).href}catch{return t}}r.lua_pushcfunction(s,function(t){const e=r.lua_gettop(t),n=[];for(let l=1;l<=e;l++){u.luaL_tolstring(t,l);const e=r.lua_tostring(t,-1);n.push(e?o(e):""),r.lua_pop(t,1)}return i(n.join("\t")),0}),r.lua_setglobal(s,a("print"));const y=new Set;async function w(e){if(!e)return;const n=v(e,window.location.href);if(y.has(n))return;const r=await t(n),u=JSON.parse(r);if(u?.modules)for(const[e,r]of Object.entries(u.modules)){const u=v(r,n);L(e,await t(u)),_(`config module loaded: ${e} <- ${u}`)}y.add(n)}const E=new Map,A=new Set;function S(t,e){r.lua_getglobal(s,a("__LS_BRIDGE")),r.lua_pushcfunction(s,e),r.lua_setfield(s,-2,a(t)),r.lua_pop(s,1)}function C(t){return document.querySelector(t)}function U(t){if(u.luaL_loadstring(s,a(t))!==r.LUA_OK)return f("syntax");p(0,r.LUA_MULTRET)!==r.LUA_OK&&f("runtime"),r.lua_settop(s,0)}r.lua_newtable(s),r.lua_setglobal(s,a("__LS_BRIDGE")),S("display",t=>{const e=r.lua_gettop(t),n=[];for(let l=1;l<=e;l++){u.luaL_tolstring(t,l);const e=r.lua_tostring(t,-1);n.push(e?o(e):""),r.lua_pop(t,1)}return i(n.join(" ")),0}),S("text",t=>{const e=r.lua_tostring(t,1),n=C(e?o(e):"");if(!n)return r.lua_pushnil(t),1;if(r.lua_gettop(t)>=2){const e=r.lua_tostring(t,2);return n.textContent=e?o(e):"",0}return r.lua_pushstring(t,a(n.textContent??"")),1}),S("html",t=>{const e=r.lua_tostring(t,1),n=C(e?o(e):"");if(!n)return r.lua_pushnil(t),1;if(r.lua_gettop(t)>=2){const e=r.lua_tostring(t,2);return n.innerHTML=e?o(e):"",0}return r.lua_pushstring(t,a(n.innerHTML??"")),1}),S("attr",t=>{const e=r.lua_tostring(t,1),n=r.lua_tostring(t,2),u=e?o(e):"",l=n?o(n):"",s=C(u);if(!s)return r.lua_pushnil(t),1;if(r.lua_gettop(t)>=3){const e=r.lua_tostring(t,3);return s.setAttribute(l,e?o(e):""),0}return r.lua_pushstring(t,a(s.getAttribute(l)??"")),1}),S("addClass",t=>{const e=r.lua_tostring(t,1),n=r.lua_tostring(t,2),u=C(e?o(e):"");return u&&u.classList.add(n?o(n):""),0}),S("removeClass",t=>{const e=r.lua_tostring(t,1),n=r.lua_tostring(t,2),u=C(e?o(e):"");return u&&u.classList.remove(n?o(n):""),0}),S("toggleClass",t=>{const e=r.lua_tostring(t,1),n=r.lua_tostring(t,2),u=C(e?o(e):"");return u&&u.classList.toggle(n?o(n):""),0}),S("when",t=>{const e=r.lua_tostring(t,1),n=r.lua_tostring(t,2),l=e?o(e):"",a=n?o(n):"";let s;if(r.lua_type(t,3)===r.LUA_TFUNCTION){r.lua_pushvalue(t,3);s={kind:"ref",value:u.luaL_ref(t,r.LUA_REGISTRYINDEX)}}else{const e=r.lua_tostring(t,3);s={kind:"name",value:e?o(e):""}}const i=`${l}|${a}`;var c;return E.has(i)||E.set(i,[]),E.get(i).push(s),c=l,A.has(c)||(A.add(c),document.addEventListener(c,t=>{for(const[e,n]of E.entries()){const r=e.indexOf("|"),u=e.slice(0,r),l=e.slice(r+1);if(u!==c)continue;const a=t.target?.closest?t.target.closest(l):null;if(!a)continue;const o=[t.type,l,a.id||"","string"==typeof a.className?a.className:""];for(const t of n)"name"===t.kind?m(t.value,...o):b(t.value,...o)}},!0),_(`bound DOM event: ${c}`)),0}),S("http_get",t=>{const e=r.lua_tostring(t,1),n=e?o(e):"";let l;if(r.lua_type(t,2)===r.LUA_TFUNCTION){r.lua_pushvalue(t,2);const e=u.luaL_ref(t,r.LUA_REGISTRYINDEX);l={kind:"ref",value:e}}else{const e=r.lua_tostring(t,2);l={kind:"name",value:e?o(e):""}}return fetch(n).then(async t=>{const e=await t.text();"name"===l.kind?m(l.value,t.status,e):b(l.value,t.status,e)}).catch(t=>{"name"===l.kind?m(l.value,0,String(t)):b(l.value,0,String(t))}),0}),L("luascript","\n  local bridge = __LS_BRIDGE\n  local M = {}\n\n  function M.display(...) bridge.display(...) end\n  function M.when(eventName, selector, handler) bridge.when(eventName, selector, handler) end\n  function M.get(url, handler) bridge.http_get(url, handler) end\n\n  function M.text(selector, value) return bridge.text(selector, value) end\n  function M.html(selector, value) return bridge.html(selector, value) end\n  function M.attr(selector, name, value) return bridge.attr(selector, name, value) end\n  function M.addClass(selector, cls) return bridge.addClass(selector, cls) end\n  function M.removeClass(selector, cls) return bridge.removeClass(selector, cls) end\n  function M.toggleClass(selector, cls) return bridge.toggleClass(selector, cls) end\n\n  return M\n      ");const M=Array.from(document.querySelectorAll("lua-script, script[type='lua']"));for(const n of M){n.hidden=!0,i=e(n),c="true"===n.getAttribute("debug")||d;try{await w(n.getAttribute("config"))}catch(t){c&&i("[LuaError] config: "+t.message);continue}let r="";r="lua-script"===n.tagName.toLowerCase()?n.textContent||"":n.getAttribute("src")?await t(n.getAttribute("src")):n.textContent||"",U(r),_("LuaScript runtime finished one script node")}_("LuaScript runtime ready")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>n().catch(console.error)):n().catch(console.error)})();